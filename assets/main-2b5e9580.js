import{t as s}from"./translate-b5e7b0e5.js";const c="https://morganehuebra.github.io/WeasleyProject",w={archaeologist:{useComputers:!1,speakAncienLanguages:!0,readRunes:!0,makeExcavation:!0,findSecretPassages:!1},spy:{useComputers:!0,speakAncienLanguages:!1,readRunes:!1,makeExcavation:!1,findSecretPassages:!0}},h="jobWalletButton";let r=null;const f=e=>{WA.player.state.job=e},$=async()=>{WA.controls.disablePlayerControls(),r=await WA.ui.website.open({url:`${c}/views/jobWallet/jobWallet.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}}),WA.player.state.askForJobWalletWebsiteClose=!1},m=()=>{r==null||r.close(),r=null,WA.controls.restorePlayerControls()},W=()=>{WA.ui.actionBar.addButton({id:h,label:s("modules.job.myJobWallet.label"),callback:async()=>{r?m():await $()}})},A=()=>{WA.ui.actionBar.removeButton(h)},I=()=>{WA.player.state.job?W():A(),WA.player.state.onVariableChange("job").subscribe(e=>{e?(console.log(s("modules.job.jobChanged",{job:s(`modules.job.jobs.${e}`)})),W()):A()}),WA.player.state.onVariableChange("askForJobWalletWebsiteClose").subscribe(e=>{e&&m()})},v=e=>WA.player.state.job&&w[WA.player.state.job][e];let u=null;const L=(e=["excavationZone"],o=null)=>{if(v("makeExcavation"))for(let a=0;a<e.length;a++)WA.state[`${e[a]}Discovered`]?WA.room.showLayer(`${e[a]}/found`):(WA.room.showLayer(`${e[a]}/trace`),WA.room.onEnterLayer(`${e[a]}/trace`).subscribe(()=>{WA.state[`${e[a]}Discovered`]||(u=WA.ui.displayActionMessage({message:s("utils.executeAction",{action:s("modules.excavation.makeExcavations")}),callback:()=>{WA.state[`${e[a]}Discovered`]=!0}}))}),WA.room.onLeaveLayer(`${e[a]}/trace`).subscribe(()=>{u==null||u.remove()}),WA.state.onVariableChange(`${e[a]}Discovered`).subscribe(()=>{C(e[a],o?o[a]:null)}))},C=(e,o=null)=>{WA.room.hideLayer(`${e}/trace`),WA.room.showLayer(`${e}/search`),setTimeout(()=>{WA.room.showLayer(`${e}/found`),setTimeout(()=>{WA.room.hideLayer(`${e}/search`),o&&o()},1e3)},3e3)};let b=null;const k=e=>{const o=[];for(let a=1;a<31;a++)for(let t=1;t<21;t++)o.push({x:a,y:t,tile:null,layer:`${e}/block`});WA.room.setTiles(o),console.log("salut")},V=(e=["secretPassageZone"],o=null)=>{if(v("findSecretPassages"))for(let a=0;a<e.length;a++)WA.state[`${e[a]}Discovered`]?(WA.room.showLayer(`${e[a]}/found`),WA.room.hideLayer(`${e[a]}/disappear`)):(WA.room.showLayer(`${e[a]}/trace`),WA.room.onEnterLayer(`${e[a]}/trace`).subscribe(()=>{WA.state[`${e[a]}Discovered`]||(b=WA.ui.displayActionMessage({message:s("utils.executeAction",{action:s("modules.secretPassage.findSecretPassage")}),callback:()=>{WA.state[`${e[a]}Discovered`]=!0}}))}),WA.room.onLeaveLayer(`${e[a]}/trace`).subscribe(()=>{b==null||b.remove()}),WA.state.onVariableChange(`${e[a]}Discovered`).subscribe(()=>{B(e[a],o?o[a]:null)}))},B=(e,o=null)=>{WA.room.hideLayer(`${e}/trace`),WA.room.showLayer(`${e}/search`),setTimeout(()=>{WA.room.showLayer(`${e}/found`),WA.room.hideLayer(`${e}/disappear`),k(e),setTimeout(()=>{WA.room.hideLayer(`${e}/search`),o&&o()},1e3)},3e3)},E=e=>{for(let o=0;o<e.length;o++)WA.room.onEnterLayer(e[o].stepIn).subscribe(()=>{WA.room.hideLayer(e[o].hide)}),WA.room.onLeaveLayer(e[o].stepIn).subscribe(()=>{WA.room.showLayer(e[o].hide)})},j=async()=>{await WA.player.state.saveVariable("isInviting",null,{public:!0}),await WA.player.state.saveVariable("hasBeenInvited",null,{public:!0}),await WA.player.state.saveVariable("hasAcceptedInvitation",null,{public:!0}),await WA.players.configureTracking(),WA.players.onVariableChange("isInviting").subscribe(e=>{e.value===WA.player.uuid&&(console.log("vous avez été invité par :"+e.player.name),WA.player.state.hasBeenInvited=e.value,F())}),WA.players.onVariableChange("hasBeenInvited").subscribe(e=>{!e.value&&WA.player.state.isInviting===e.player.uuid&&(console.log(e.player.name+"a refusé votre invitation"),WA.player.state.isInviting=null)}),WA.players.onVariableChange("isInviting").subscribe(e=>{!e.value&&WA.player.state.hasBeenInvited===e.player.uuid&&(console.log(e.player.name+"a annulé son invitation"),WA.player.state.hasBeenInvited=null,d(),p())}),WA.players.onVariableChange("hasAcceptedInvitation").subscribe(e=>{console.log("Someone accepted en invitation",e.player.uuid),e.value===WA.player.uuid&&(R(),console.log("REDIRECTION VERS LE JEU ! pour :"+WA.player.name+" et "+e.player.name))}),await WA.player.state.saveVariable("playerImage",await WA.player.getWokaPicture(),{public:!0}),await WA.player.state.saveVariable("isAuthenticated",WA.player.isLogged,{public:!0}),WA.player.state.onVariableChange("askForPlayersListWebsiteClose").subscribe(e=>{e&&y()}),WA.player.state.onVariableChange("askForPlayersInvitationWebsiteClose").subscribe(e=>{e&&(d(),p())}),WA.player.state.onVariableChange("askForCancelInvitation").subscribe(e=>{console.log("askForCancelInvitation changed",e),e&&(console.log("value"),S(),D())}),WA.player.state.onVariableChange("isInviting").subscribe(e=>{e&&(y(),J())}),WA.ui.actionBar.addButton({id:"playerListButton",label:"Joueurs",callback:()=>{l||(i?y():_())}})};let i=null;const _=async()=>{i=await WA.ui.website.open({url:`${c}/views/lobby/playerList.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}}),WA.player.state.askForPlayersListWebsiteClose=!1},y=()=>{console.log("close player list",i),i==null||i.close(),i=null};let n=null;const F=async()=>{n=await WA.ui.website.open({url:`${c}/views/lobby/invitationReceived.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}}),WA.player.state.askForPlayersInvitationWebsiteClose=!1},d=()=>{console.log("close invitation"),n==null||n.close(),n=null},p=()=>{WA.player.state.hasBeenInvited=null};let l=null;const J=async()=>{console.log("open waiting for answer website"),l=await WA.ui.website.open({url:`${c}/views/lobby/waitingForAnswer.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}}),WA.player.state.askForCancelInvitation=!1,console.log(l)},S=()=>{console.log("close waiting for answer website"),l==null||l.close(),l=null},D=()=>{console.log("RESET INVITED"),console.log("waitingForAnswerWebsite",l),WA.player.state.isInviting=null},R=async()=>{await WA.ui.website.open({url:`${c}/views/lobby/youAreGoingToBeRedirected.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}})},z=(e=["switchingTiles"])=>{for(let o=0;o<e.length;o++){const a=JSON.parse(WA.state[`${e[o]}VictoryCondition`]);for(let t=0;t<Object.keys(a).length;t++)console.log(`${e[o]}/${t}_layer/zone`),WA.room.onEnterLayer(`${e[o]}/${t}_layer/zone`).subscribe(()=>{console.log("entered layer");let g=WA.state[`${e[o]}_${t}_value`]?WA.state[`${e[o]}_${t}_value`]:0;WA.state[`${e[o]}_${t}_value`]=(g+1)%3,WA.room.hideLayer(`${e[o]}/${t}_layer`),WA.room.showLayer(`${e[o]}/${t}_layer/${WA.state[`${e[o]}_${t}_value`]}`),console.log("changed tile value to : "+WA.state[`${e[o]}_${t}_value`])})}};WA.onInit().then(()=>{console.log("INITIALISATION"),I(),f("spy"),console.log("HERE"),L(["excavation"],[()=>{console.log("test callback after excavation")}]),V(["secretPassage"],[()=>{console.log("test callback after finding secret passage")}]),E([{stepIn:"hiddenZoneFloor",hide:"hiddenZoneTop"}]),console.log("Initiate switching tiles"),z(),console.log("LOBBY INITIALISATION"),j()}).catch(e=>console.error(e));
