import{c as d,t as c,r as u,i as p,s as h}from"./job-01c7551a.js";let s=null;const v=(e=["excavationZone"],a=null)=>{if(d("makeExcavation"))for(let o=0;o<e.length;o++)WA.state[`${e[o]}Discovered`]?WA.room.showLayer(`${e[o]}/found`):(WA.room.showLayer(`${e[o]}/trace`),WA.room.onEnterLayer(`${e[o]}/trace`).subscribe(()=>{WA.state[`${e[o]}Discovered`]||(s=WA.ui.displayActionMessage({message:c("utils.executeAction",{action:c("modules.excavation.makeExcavations")}),callback:()=>{WA.state[`${e[o]}Discovered`]=!0}}))}),WA.room.onLeaveLayer(`${e[o]}/trace`).subscribe(()=>{s==null||s.remove()}),WA.state.onVariableChange(`${e[o]}Discovered`).subscribe(()=>{m(e[o],a?a[o]:null)}))},m=(e,a=null)=>{WA.room.hideLayer(`${e}/trace`),WA.room.showLayer(`${e}/search`),setTimeout(()=>{WA.room.showLayer(`${e}/found`),setTimeout(()=>{WA.room.hideLayer(`${e}/search`),a&&a()},1e3)},3e3)};let n=null;const g=e=>{const a=[];for(let o=1;o<31;o++)for(let i=1;i<21;i++)a.push({x:o,y:i,tile:null,layer:`${e}/block`});WA.room.setTiles(a),console.log("salut")},$=(e=["secretPassageZone"],a=null)=>{if(d("findSecretPassages"))for(let o=0;o<e.length;o++)WA.state[`${e[o]}Discovered`]?(WA.room.showLayer(`${e[o]}/found`),WA.room.hideLayer(`${e[o]}/disappear`)):(WA.room.showLayer(`${e[o]}/trace`),WA.room.onEnterLayer(`${e[o]}/trace`).subscribe(()=>{WA.state[`${e[o]}Discovered`]||(n=WA.ui.displayActionMessage({message:c("utils.executeAction",{action:c("modules.secretPassage.findSecretPassage")}),callback:()=>{WA.state[`${e[o]}Discovered`]=!0}}))}),WA.room.onLeaveLayer(`${e[o]}/trace`).subscribe(()=>{n==null||n.remove()}),WA.state.onVariableChange(`${e[o]}Discovered`).subscribe(()=>{w(e[o],a?a[o]:null)}))},w=(e,a=null)=>{WA.room.hideLayer(`${e}/trace`),WA.room.showLayer(`${e}/search`),setTimeout(()=>{WA.room.showLayer(`${e}/found`),WA.room.hideLayer(`${e}/disappear`),g(e),setTimeout(()=>{WA.room.hideLayer(`${e}/search`),a&&a()},1e3)},3e3)},f=e=>{for(let a=0;a<e.length;a++)WA.room.onEnterLayer(e[a].stepIn).subscribe(()=>{WA.room.hideLayer(e[a].hide)}),WA.room.onLeaveLayer(e[a].stepIn).subscribe(()=>{WA.room.showLayer(e[a].hide)})},I=async()=>{await WA.player.state.saveVariable("isInviting",null,{public:!0}),await WA.player.state.saveVariable("hasBeenInvited",null,{public:!0}),await WA.player.state.saveVariable("hasAcceptedInvitation",null,{public:!0}),await WA.players.configureTracking(),WA.players.onVariableChange("isInviting").subscribe(e=>{e.value===WA.player.uuid&&(console.log("vous avez été invité par :"+e.player.name),WA.player.state.hasBeenInvited=e.value,C())}),WA.players.onVariableChange("hasBeenInvited").subscribe(e=>{!e.value&&WA.player.state.isInviting===e.player.uuid&&(console.log(e.player.name+"a refusé votre invitation"),WA.player.state.isInviting=null)}),WA.players.onVariableChange("isInviting").subscribe(e=>{!e.value&&WA.player.state.hasBeenInvited===e.player.uuid&&(console.log(e.player.name+"a annulé son invitation"),WA.player.state.hasBeenInvited=null,A(),W())}),WA.players.onVariableChange("hasAcceptedInvitation").subscribe(e=>{console.log("Someone accepted en invitation",e.player.uuid),e.value===WA.player.uuid&&(B(),console.log("REDIRECTION VERS LE JEU ! pour :"+WA.player.name+" et "+e.player.name))}),await WA.player.state.saveVariable("playerImage",await WA.player.getWokaPicture(),{public:!0}),await WA.player.state.saveVariable("isAuthenticated",WA.player.isLogged,{public:!0}),WA.player.state.onVariableChange("askForPlayersListWebsiteClose").subscribe(e=>{e&&y()}),WA.player.state.onVariableChange("askForPlayersInvitationWebsiteClose").subscribe(e=>{e&&(A(),W())}),WA.player.state.onVariableChange("askForCancelInvitation").subscribe(e=>{console.log("askForCancelInvitation changed",e),e&&(console.log("value"),E(),k())}),WA.player.state.onVariableChange("isInviting").subscribe(e=>{e&&(y(),V())}),WA.ui.actionBar.addButton({id:"playerListButton",label:"Joueurs",callback:()=>{l||(t?y():L())}})};let t=null;const L=async()=>{t=await WA.ui.website.open({url:`${u}/views/lobby/playerList.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}}),WA.player.state.askForPlayersListWebsiteClose=!1},y=()=>{console.log("close player list",t),t==null||t.close(),t=null};let r=null;const C=async()=>{r=await WA.ui.website.open({url:`${u}/views/lobby/invitationReceived.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}}),WA.player.state.askForPlayersInvitationWebsiteClose=!1},A=()=>{console.log("close invitation"),r==null||r.close(),r=null},W=()=>{WA.player.state.hasBeenInvited=null};let l=null;const V=async()=>{console.log("open waiting for answer website"),l=await WA.ui.website.open({url:`${u}/views/lobby/waitingForAnswer.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}}),WA.player.state.askForCancelInvitation=!1,console.log(l)},E=()=>{console.log("close waiting for answer website"),l==null||l.close(),l=null},k=()=>{console.log("RESET INVITED"),console.log("waitingForAnswerWebsite",l),WA.player.state.isInviting=null},B=async()=>{await WA.ui.website.open({url:`${u}/views/lobby/youAreGoingToBeRedirected.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}})},_=(e=["switchingTiles"])=>{for(let a=0;a<e.length;a++){const o=JSON.parse(WA.state[`${e[a]}VictoryCondition`]);for(let i=0;i<Object.keys(o).length;i++)console.log(`${e[a]}/${i}_layer/zone`),WA.room.onEnterLayer(`${e[a]}/${i}_layer/zone`).subscribe(()=>{console.log("entered layer");let b=WA.state[`${e[a]}_${i}_value`]?WA.state[`${e[a]}_${i}_value`]:0;WA.state[`${e[a]}_${i}_value`]=(b+1)%3,WA.room.hideLayer(`${e[a]}/${i}_layer`),WA.room.showLayer(`${e[a]}/${i}_layer/${WA.state[`${e[a]}_${i}_value`]}`),console.log("changed tile value to : "+WA.state[`${e[a]}_${i}_value`])})}};WA.onInit().then(()=>{console.log("INITIALISATION"),p(),h("spy"),console.log("HERE"),v(["excavation"],[()=>{console.log("test callback after excavation")}]),$(["secretPassage"],[()=>{console.log("test callback after finding secret passage")}]),f([{stepIn:"hiddenZoneFloor",hide:"hiddenZoneTop"}]),console.log("Initiate switching tiles"),_(),console.log("LOBBY INITIALISATION"),I()}).catch(e=>console.error(e));
