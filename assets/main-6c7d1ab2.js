const g={executeAction:"[Espace] {action}",shoot:"Tirer",see:"Consulter",examine:"Examiner",seeTheRules:"Voir les règles"},p={jobChanged:"Vous êtes maintenant {job}",jobs:{archaeologist:"Archéologue",spy:"Espion"},myJobWallet:{label:"Portefeuille"}},h={makeExcavations:"Faire des fouilles"},y=Object.freeze(Object.defineProperty({__proto__:null,job:p,excavation:h},Symbol.toStringTag,{value:"Module"})),f={title:"Carte d'{job}",name:"Nom",jobs:{archaeologist:{name:"Archéologue",attributes:"Nom : {name}<br> Niveau: Avancé",description:"Félicitations, vous êtes désormais membre des archéologues en herbe. Nous certifions par la délivrance de la présente carte que vous pouvez :",permissions:{speakAncienLanguages:"Parler les anciens langages",readRunes:"Lire les runes",makeExcavation:"Faire des fouilles"}},spy:{name:"Espion",attributes:"Nom : {name}<br> Matricule: 007",description:"Agent spécial d'état. Spacialisé dans :",permissions:{useComputers:"le piratage informatique",findSecretPassages:"trouver et emprunter les passages secrets"}}}},A=Object.freeze(Object.defineProperty({__proto__:null,jobWallet:f},Symbol.toStringTag,{value:"Module"})),j=Object.freeze(Object.defineProperty({__proto__:null,utils:g,modules:y,views:A},Symbol.toStringTag,{value:"Module"})),W={executeAction:"[Space] {action}",shoot:"Shoot",see:"See",examine:"Examiner",seeTheRules:"See the rules"},v={jobChanged:"You are now a(n) {job}",jobs:{archaeologist:"Archaeologist",spy:"Spy"},myJobWallet:{label:"Wallet"}},S={makeExcavations:"Make excavations"},_=Object.freeze(Object.defineProperty({__proto__:null,job:v,excavation:S},Symbol.toStringTag,{value:"Module"})),k={title:"{job} card",name:"Name",jobs:{archaeologist:{name:"Archaeologist",attributes:"Name : {name}<br> Level: Advanced",description:"Congratulations, you are now a member of the Budding Archaeologists. We certify by the issuance of this card that you can :",permissions:{speakAncienLanguages:"Speak the old languages",readRunes:"Read the runes",makeExcavation:"Make excavation"}},spy:{name:"Spy",attributes:"Name : {name}<br> Registration number: 007",description:"Special state agent. Specialized in :",permissions:{useComputers:"computer hacking",findSecretPassages:"find and use the secret passages"}}}},$=Object.freeze(Object.defineProperty({__proto__:null,jobWallet:k},Symbol.toStringTag,{value:"Module"})),w=Object.freeze(Object.defineProperty({__proto__:null,utils:W,modules:_,views:$},Symbol.toStringTag,{value:"Module"})),d={"fr-FR":j,"en-US":w};let i="fr-FR";WA.onInit().then(()=>{i=WA.player.language,Object.keys(d).includes(i)||(i="en-US")});const E=(e,t={})=>{let n=e;const a=Object.keys(t);for(let o=0;o<a.length;o++)n=n.replaceAll("{"+a[o]+"}",t[a[o]]);return n},r=(e,t={})=>{const a=e.split(".").reduce((o,c)=>(!o||!o[c]?o=void 0:o=o[c],o),d[i]);return a&&typeof a=="string"?E(a,t):e},L={archaeologist:{useComputers:!1,speakAncienLanguages:!0,readRunes:!0,makeExcavation:!0,findSecretPassages:!1},spy:{useComputers:!0,speakAncienLanguages:!1,readRunes:!1,makeExcavation:!1,findSecretPassages:!0}},m="jobWalletButton";let s=null;const P=e=>{WA.player.state.job=e},x=async()=>{WA.controls.disablePlayerControls(),s=await WA.ui.website.open({url:"http://localhost:5173/views/jobWallet/jobWallet.html?name=test",allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}})},O=()=>{s==null||s.close(),s=null,WA.controls.restorePlayerControls()},u=()=>{WA.ui.actionBar.addButton({id:m,label:r("modules.job.myJobWallet.label"),callback:async()=>{s?O():await x()}})},b=()=>{WA.ui.actionBar.removeButton(m)},C=()=>{WA.player.state.job?u():b(),WA.player.state.onVariableChange("job").subscribe(e=>{e?(console.log(r("modules.job.jobChanged",{job:r(`modules.job.jobs.${e}`)})),u()):b()})},T=e=>WA.player.state.job&&L[WA.player.state.job][e];let l=null;const N=(e=["excavationZone"])=>{if(T("makeExcavation"))for(let t=0;t<e.length;t++)WA.state[`${e[t]}Discovered`]?WA.room.showLayer(`${e[t]}/found`):(WA.room.showLayer(`${e[t]}/trace`),WA.room.onEnterLayer(`${e[t]}/trace`).subscribe(()=>{WA.state[`${e[t]}Discovered`]||(l=WA.ui.displayActionMessage({message:r("utils.executeAction",{action:r("modules.excavation.makeExcavations")}),callback:()=>{WA.state[`${e[t]}Discovered`]=!0}}))}),WA.room.onLeaveLayer(`${e[t]}/trace`).subscribe(()=>{l==null||l.remove()}),WA.state.onVariableChange(`${e[t]}Discovered`).subscribe(()=>{R(e[t])}))},R=e=>{WA.room.hideLayer(`${e}/trace`),WA.room.showLayer(`${e}/search`),setTimeout(()=>{WA.room.showLayer(`${e}/found`),setTimeout(()=>{WA.room.hideLayer(`${e}/search`)},1e3)},3e3)};WA.onInit().then(()=>{console.log("INITIALISATION"),C(),P("archaeologist"),console.log("HERE"),N(["excavation"])}).catch(e=>console.error(e));
